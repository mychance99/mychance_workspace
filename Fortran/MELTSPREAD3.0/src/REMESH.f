C...................................................................... 
C.....SUBROUTINE REMESH CHECKS IF ABLATION DEPTH OF BASEMAT NODAL CELLS
C.....AND IF IT IS LESS THAN THE MINIMUM VALUE, IT REMESHES SO THAT  
C.....ABLATION INTO THE NEXT CELL CAN OCCUR.
C...................................................................... 
      SUBROUTINE REMESH(IFAILJ)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION HSEND(28)
      COMMON/CATCHR/A(999),B(999),C(999),D(999),P(999),Q(999),
     1RECON(999),DELVEL(999),DSRDT(999),DELHTS(999),EMAX(999,999),
     2DBLKEN(999),DELHIT(16,999),SOURCE(16,999),SRCTOT(999),
     3HCROLD(16,999),DCDOT(999),HCRUST(16,999),DFILM(16,999),
     4DFMOLD(16,999),DENOLD(999),SIGOX(999),SIGCON(999),BET(999),
     5TFZX(999),TFZC(999),TKX(999),TKM(999),THETO(999,999),
     6THET1(999,999),OMEG0(4,999),OMEG1(4,999),TAO0(999),TAO1(999),
     7SIG0(999),SIG1(999),TARGB(999),DADOT(999),DADOTG(999),
     8XLOLD(4,999),VISREX(999),TATMS(999),HTMP(999),DHTMP(999),
     9HTMOLD(999)
      COMMON/CATCHI/NUMS(4,999),NUMOLD(4,999),NTRACK(16),NSUMP(999),
     1NPASSG(999),NCRSTM(999),NCRRT(999),NPASS(999),NBURN,NBURNO     
      COMMON/PRINTB/ELEVAT(999),ELOLD(999),XDIST(999,999),XBTW(999,999),
     1TEMP(999,999),ENTHP(999,999),EOLD(999,999),ENBLK(999),EBKOLD(999),
     2TBULK(999),HITE(16,999),HITOLD(16,999),HTOT(999),HTOLD(999),
     3HTCFT(999),HTCOEF(999),QFLUXT(999),QFLUXB(999),VEL(999),ELO(999),
     4VELOLD(999),SRSCOR(16),AREA(999),RAD(999),ARC(999),VOLCN(16),
     5VOID(999),VGJ(999),ZABLAT(999),ZABOLD(999),DCRUST(999),
     6DCROLD(999),DABCON(999),DABOLD(999),DFILMT(999),DFOLT(999),
     7SMFLX(4,999),XLSMF(4,999),TOTVOL,XFACMS(999),XMFLXA,XMCORT,
     8VCORT,TOTOX,TOTMET,QFLXT,QFLXB,TIME,DTIME,XMCOR(16),VCOR(16),
     9TCONI,RSAND,HDOWNC,TBOUND,EMISCN,PDRYWL,XDISTO(999),QOXT(999),
     1XLENSH,XBTWO(999),RCOMP,WDOOR,RSUMP,RSHELL,RPED,TPED,ELSMP,
     1TENDP(10,999),TFRZSH,TDEBRS,TKDEBR,PDEBR,CPDEBR,ENENDP(10,999),
     2ENOLDP(10,999),DXVERT,DXSNK,XDSTE(10,999),XBTE(10,999),HXLA(999),
     3HXLB(999),TSFEB(999),DCRS(999),DCRSLD(999),HCRS(16,999),
     4HCRSLD(16,999),THETE0(10,999),THETE1(10,999),QSHELL,QSHELE,TSHELI,
     5SIGOXE(999),FKOXE(999),RINJC,XLSEC,ANGSEC,ANINJC,XLCHAN,WCHNL,
     6TEFZX(999),TIMSPC(999),DXNODE(999),TNORM(999),FRCSOL(999),
     7ALPSPR(999),CRAMCON,HINTF,TSHLMX,XFRMX(999),XFROX(999),XFRTX(999),
     8XMLMX(999),XMLOX(999),XMLTX(999),XTOTX(999),TIMEO,TMAX,EDOWN(999),
     9HCP(999)
      COMMON/HCONS/HMETAL(999),HOXIDE(999)  
      COMMON/PROPI/ NMATC,NMATFI,NMATFF,ICAOH2,ICACO3,IMCCO3,IFH2O,     
     1IVH2O,ICK2O,IVK2O,INA2O,ITIO2,ISIO2,ICAO,IMGO,IAL2O3,IFEO,IFE2O3, 
     2IFE3O4,IFE,ICR,INI,IZR,IU,IB4C,IB,ICR2O3,INIO,IUO2,IZRO2,IB2O3,   
     3NBCINT(999),NODES(999),NUMNOD,IMOX(28),IBAS,ILCS,ILL,NACTIV(999),     
     4NBFRZM,NBFRZO,NABLFM,NDRNFM,NTYPMT(999,999),NDOOR,NBMADJ,NUMSHV,   
     5NBSHL(999),NCRSTS(999),NUMSHH,NSKIPE,NACSH,NWAT,NPEND,NBCBOT,
     6NCRTOP,NBFZOE,NBFZME,NGEOM,NL(999,999),NFRSCT,NLOGSH,NADAB,NINVIS,
     7NSIMST,NSTEEL,NOVHT,NOVTK,NOVUM,NOVEM,NOVSIG,NPLLOC(999),NBPL,
     8IXP(999),IYP(999),NVTPE,NSOLTP,NSOLF,NINTF,IFLGA(999),ICTYPE,ICTC,
     9NPOURS,NSMP,NPED,NDOR,NSHL,NANULS,NSMPCV,NBOIL,NSWALL,NMVER,
     1NCRTEM,NTHINC,NVELP,NITMAX,NENMAX,NPRINT,NPFREQ,NTIMSPC,NPLFREQ,
     2NPLTOT,NJET,NJETP,NJETD,NJETND,NODCAP,NVELPW,NITMAXW,NENMXW,
     3IFLGJ(999),NBEDCQ,ISHELE
      COMMON/DATOVER/COVS,COVL,DHSOV,XMOLOV,ROVS,ROVL,TKOVS,TKOVL,VISOV,
     1EMOV,SIGOV
      COMMON/PRINTR/ QFEH2O,QCRH2O,QZRH2O,QFECO2,QCRCO2,QZRCO2,
     4XFH2OU,XFCAOH,XFMGCA,XFCACO,XZRMRE,XFEMRE,XCRMRE,XZRORE,XFEORE,   
     5XCRORE,XMH2O,XMCO2,XMCACO,XMMGCA,XMCAOH,TFWL,TFWS,TBWL,TBWS,      
     6TMCAL,TMCAS,TCAL,TCAS,TFOS,TFOL,TFMS,TFML,XVISC(28),SVISC(28),    
     7XMOL(28),FMMOL(28),ROM(28),ROMLIQ(28),AEQM(28,2),BEQM(28,2),
     8CEQM(28,2),ECL,ECS,ECAL,ECAS,EMCAL,EMCAS,EBWL,EBWS,EFWL,EFWS,    
     9STEF,GRAV,PI,TCS,TCL,CCL,CCS,RMASSL,WPCC,WPM,WPA,WPCS,ROC,RMASSS,   
     1ANGSHL,RSLAGL,RSLAGS,HNODT,VFAV,VGAV,QXAV,XWTSS(16),  
     2TSCS(2),TSCL(2),ESCS(2),ESCL(2),CCSS(2),CCSL(2),ROSTLS,ROSTLL,
     3XFRGAS,HMINC,TST(99),TSTOP(99),AINTP(99),BINTP(99),DRATIO(999),
     4XBCN(999),XDCN(999),XBLT(15),ADEC(99),BDEC(99),APOUR(16,99),
     5BPOUR(16,99),XWTC(14),BWIDTH,THCKCV,TMBOIL,TEBOIL,VFINT,ANGFAN,
     6ALPMAX,THSHL,XFCABL,XNDMIN,DVMX,DAVMX,DEAVMX,DEMX,TDC,QDCU,QDCUO2,
     7TSINJ,EINJ,DTINJ,TKINJ,ROEV,CPINJ,SURFT,VSINJ,EMINJ,TSINJO,EINJO,
     8DTINJO,TKINJO,ROEVO,CPINJO,SURFTO,VSINJO,EMINJO,XLEADE,ARSUM,
     9DBUBOX,UTRISE,TREMSH,DJET,DFALL,WEBER,FROUDE,XPSAITO,XPEPSTN,
     1FRAG,XMBEDT,XMBED(16),XLPENT,XLPENA,UJET,UFALL,HFALL,ERPV,
     2TJETT(99),DJETT(99),HWATP,XDOTJET,DVMXW,DAVMXW,DEMXW,DEAVMXW,
     3QJETW,XSTMJF,TINTSJF,ESAT,DRDOOR,DRANL,EI,QDCBUO2,QDCBU,
     4EBEDS,EBEDB
      COMMON/BLKHT/TKMLT,PM,CM,UM,EMISM,SIGMAM,TKNC,PNC,CNC,UNC    
      COMMON/BASPR/ HBMT(999,999,16),HBMOLD(999,999,16) 
      COMMON/DATSH/TSTLS,TSTLL,ESTLS,ESTLL,DFUSST,CSTLL
      COMMON/DATSIMS/TSIS,TSIL,CSIS,CSIL,DHSIL,RSIS,RSIL,TKSIS,TKSIL,
     1ESIL,XCSI(16)
      COMMON/DEFUNC/CPLIQP,CPSOLP,EFOSP,EFOLP,EFMSP,EFMLP     
      COMMON/PROPB/CPBM(999),FKB(999,999),DENB(999,999),DTDEB(999,999),
     1EMIBM(999),DENCRS(999),ENCRS(999),FKRF(999),DENRF(999),CPRF(999) 
      COMMON/PROPM/DTDEM(999),CPMLT(999),FKMLT(999),DENMLT(999),
     1SIGMLT(999),UMMLT(999),EMIMLT(999)      
C.....MARCH THROUGH THE MESH LATERALLY AND CHECK CONDITIONS FOR VERTICAL
C.....REMESHING
      DO 2032 KN=1,NUMNOD
      IF(NBCINT(KN).LE.3) GO TO 2032      
      ZCOMP=XDISTO(KN)-ZABLAT(KN)
      IF(ZCOMP.LT.XBTWO(KN)) GO TO 2032   
      IP=2  
      IF(NTYPMT(IP,KN).GT.3) GO TO 6048   
      TEMP(1,KN)=TSCS(NL(IP,KN))
      ENTHP(1,KN)=ESCS(NL(IP,KN))
      GO TO 6049      
 6048 CONTINUE
      CALL ASINED(IP,KN,HSEND,ROM,WPCC,WPM,WPA,WPCS,ROC,RSLAGS,0)
      TEMP(1,KN)=TFOS 
      IF(NTYPMT(1,KN).EQ.4) TEMP(1,KN)=TFMS
      CALL ETF(ENTHP(1,KN),HSEND,TEMP(1,KN),DTDE)   
      DTDEB(1,KN)=DTDE
 6049 CONTINUE
      XLSTRT=XDISTO(KN)-XBTWO(KN)
      XLMIN=XFCABL*XLSTRT
      IF(ZABLAT(KN).GT.XLMIN) GO TO 2032  
      ZBOLD=ZABLAT(KN)
      NODES(KN)=NODES(KN)-1     
      IF(NODES(KN).GE.3) GO TO 3332
      WRITE(6,7671) TIME,KN
      WRITE(2,7671) TIME,KN
 7671 FORMAT(//,1X,'****BASEMAT ABLATION HAS LOCALLY REDUCED THE NUMBER
     1OF NODES TO 3, INCREASE NODALIATION DEPTH AND RESTART, TIME=',
     2 G12.5,' LATERAL NODE=',I4)
      IFAILJ=1
      GO TO 110
 3332 CONTINUE
      ZABLAT(KN)=ZABLAT(KN)+XDIST(2,KN)   
      ZABOLD(KN)=ZABLAT(KN)
      XDISTO(KN)=XDIST(2,KN)+ZBOLD
      XBTWO(KN)=XBTW(2,KN)+ZBOLD
      DO 2034 KGS=1,4 
      IF(NUMS(KGS,KN).GT.2) GO TO 6930   
      IF(NUMS(KGS,KN).EQ.2) XLSMF(KGS,KN)=XLSMF(KGS,KN)+ZBOLD
      NUMS(KGS,KN)=1  
      GO TO 2034      
 6930 CONTINUE
      NUMS(KGS,KN)=NUMS(KGS,KN)-1
 2034 CONTINUE
      DO 2035 KV=1,NODES(KN)    
      ZMULT=1.D0      
      IF(KV.EQ.1) ZMULT=(ZBOLD+XBTW(2,KN))/XBTW(2,KN)
      DO 2037 KTP=1,16
      HBMT(KV,KN,KTP)=HBMT(KV+1,KN,KTP)*ZMULT
 2037 CONTINUE
      DTDEB(KV,KN)=DTDEB(KV+1,KN)
      NTYPMT(KV,KN)=NTYPMT(KV+1,KN)
      NL(KV,KN)=NL(KV+1,KN)     
      IF(KV.GT.1) GO TO 2038    
      XDIST(KV,KN)=XDIST(KV+1,KN)+ZBOLD   
      XBTW(KV,KN)=XBTW(KV+1,KN)+ZBOLD     
      GO TO 2035      
 2038 CONTINUE
      XDIST(KV,KN)=XDIST(KV+1,KN)
      XBTW(KV,KN)=XBTW(KV+1,KN) 
      TEMP(KV,KN)=TEMP(KV+1,KN) 
      ENTHP(KV,KN)=ENTHP(KV+1,KN)
      EMAX(KV,KN)=EMAX(KV+1,KN) 
 2035 CONTINUE
 2032 CONTINUE
  110 CONTINUE
      RETURN
      END