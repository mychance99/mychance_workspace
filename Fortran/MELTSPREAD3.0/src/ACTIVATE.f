C...................................................................... 
C.....AS THE CORE DEBRIS SPREADS THROUGH THE NODALIZED MESH, SUBROUTINE 
C.....ACTIVATES NOTIFIES THE THAT A NODE HAS BEEN OCCUPIED BY MELT
C.....(BY SETTING NACTIV=1), AND THEN INITIALIZES THE MELT PROPERTIES.
C.....THIS ACTIVATES THE IMPLICIT SOLUTION ROUTINES IN THE BASEMAT 
C.....COUPLED WITH THE MELT THERMAL-HYDRAULICS CALCULATION.
C......................................................................
      SUBROUTINE ACTIVATE 
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON/CATCHR/A(999),B(999),C(999),D(999),P(999),Q(999),
     1RECON(999),DELVEL(999),DSRDT(999),DELHTS(999),EMAX(999,999),
     2DBLKEN(999),DELHIT(16,999),SOURCE(16,999),SRCTOT(999),
     3HCROLD(16,999),DCDOT(999),HCRUST(16,999),DFILM(16,999),
     4DFMOLD(16,999),DENOLD(999),SIGOX(999),SIGCON(999),BET(999),
     5TFZX(999),TFZC(999),TKX(999),TKM(999),THETO(999,999),
     6THET1(999,999),OMEG0(4,999),OMEG1(4,999),TAO0(999),TAO1(999),
     7SIG0(999),SIG1(999),TARGB(999),DADOT(999),DADOTG(999),
     8XLOLD(4,999),VISREX(999),TATMS(999),HTMP(999),DHTMP(999),
     9HTMOLD(999)
      COMMON/PRINTB/ELEVAT(999),ELOLD(999),XDIST(999,999),XBTW(999,999),
     1TEMP(999,999),ENTHP(999,999),EOLD(999,999),ENBLK(999),EBKOLD(999),
     2TBULK(999),HITE(16,999),HITOLD(16,999),HTOT(999),HTOLD(999),
     3HTCFT(999),HTCOEF(999),QFLUXT(999),QFLUXB(999),VEL(999),ELO(999),
     4VELOLD(999),SRSCOR(16),AREA(999),RAD(999),ARC(999),VOLCN(16),
     5VOID(999),VGJ(999),ZABLAT(999),ZABOLD(999),DCRUST(999),
     6DCROLD(999),DABCON(999),DABOLD(999),DFILMT(999),DFOLT(999),
     7SMFLX(4,999),XLSMF(4,999),TOTVOL,XFACMS(999),XMFLXA,XMCORT,
     8VCORT,TOTOX,TOTMET,QFLXT,QFLXB,TIME,DTIME,XMCOR(16),VCOR(16),
     9TCONI,RSAND,HDOWNC,TBOUND,EMISCN,PDRYWL,XDISTO(999),QOXT(999),
     1XLENSH,XBTWO(999),RCOMP,WDOOR,RSUMP,RSHELL,RPED,TPED,ELSMP,
     1TENDP(10,999),TFRZSH,TDEBRS,TKDEBR,PDEBR,CPDEBR,ENENDP(10,999),
     2ENOLDP(10,999),DXVERT,DXSNK,XDSTE(10,999),XBTE(10,999),HXLA(999),
     3HXLB(999),TSFEB(999),DCRS(999),DCRSLD(999),HCRS(16,999),
     4HCRSLD(16,999),THETE0(10,999),THETE1(10,999),QSHELL,QSHELE,TSHELI,
     5SIGOXE(999),FKOXE(999),RINJC,XLSEC,ANGSEC,ANINJC,XLCHAN,WCHNL,
     6TEFZX(999),TIMSPC(999),DXNODE(999),TNORM(999),FRCSOL(999),
     7ALPSPR(999),CRAMCON,HINTF,TSHLMX,XFRMX(999),XFROX(999),XFRTX(999),
     8XMLMX(999),XMLOX(999),XMLTX(999),XTOTX(999),TIMEO,TMAX,EDOWN(999),
     9HCP(999)
      COMMON/PROPI/ NMATC,NMATFI,NMATFF,ICAOH2,ICACO3,IMCCO3,IFH2O,     
     1IVH2O,ICK2O,IVK2O,INA2O,ITIO2,ISIO2,ICAO,IMGO,IAL2O3,IFEO,IFE2O3, 
     2IFE3O4,IFE,ICR,INI,IZR,IU,IB4C,IB,ICR2O3,INIO,IUO2,IZRO2,IB2O3,   
     3NBCINT(999),NODES(999),NUMNOD,IMOX(28),IBAS,ILCS,ILL,NACTIV(999),     
     4NBFRZM,NBFRZO,NABLFM,NDRNFM,NTYPMT(999,999),NDOOR,NBMADJ,NUMSHV,   
     5NBSHL(999),NCRSTS(999),NUMSHH,NSKIPE,NACSH,NWAT,NPEND,NBCBOT,
     6NCRTOP,NBFZOE,NBFZME,NGEOM,NL(999,999),NFRSCT,NLOGSH,NADAB,NINVIS,
     7NSIMST,NSTEEL,NOVHT,NOVTK,NOVUM,NOVEM,NOVSIG,NPLLOC(999),NBPL,
     8IXP(999),IYP(999),NVTPE,NSOLTP,NSOLF,NINTF,IFLGA(999),ICTYPE,ICTC,
     9NPOURS,NSMP,NPED,NDOR,NSHL,NANULS,NSMPCV,NBOIL,NSWALL,NMVER,
     1NCRTEM,NTHINC,NVELP,NITMAX,NENMAX,NPRINT,NPFREQ,NTIMSPC,NPLFREQ,
     2NPLTOT,NJET,NJETP,NJETD,NJETND,NODCAP,NVELPW,NITMAXW,NENMXW,
     3IFLGJ(999),NBEDCQ,ISHELE
      COMMON/PRINTR/ QFEH2O,QCRH2O,QZRH2O,QFECO2,QCRCO2,QZRCO2,
     4XFH2OU,XFCAOH,XFMGCA,XFCACO,XZRMRE,XFEMRE,XCRMRE,XZRORE,XFEORE,   
     5XCRORE,XMH2O,XMCO2,XMCACO,XMMGCA,XMCAOH,TFWL,TFWS,TBWL,TBWS,      
     6TMCAL,TMCAS,TCAL,TCAS,TFOS,TFOL,TFMS,TFML,XVISC(28),SVISC(28),    
     7XMOL(28),FMMOL(28),ROM(28),ROMLIQ(28),AEQM(28,2),BEQM(28,2),
     8CEQM(28,2),ECL,ECS,ECAL,ECAS,EMCAL,EMCAS,EBWL,EBWS,EFWL,EFWS,    
     9STEF,GRAV,PI,TCS,TCL,CCL,CCS,RMASSL,WPCC,WPM,WPA,WPCS,ROC,RMASSS,   
     1ANGSHL,RSLAGL,RSLAGS,HNODT,VFAV,VGAV,QXAV,XWTSS(16),  
     2TSCS(2),TSCL(2),ESCS(2),ESCL(2),CCSS(2),CCSL(2),ROSTLS,ROSTLL,
     3XFRGAS,HMINC,TST(99),TSTOP(99),AINTP(99),BINTP(99),DRATIO(999),
     4XBCN(999),XDCN(999),XBLT(15),ADEC(99),BDEC(99),APOUR(16,99),
     5BPOUR(16,99),XWTC(14),BWIDTH,THCKCV,TMBOIL,TEBOIL,VFINT,ANGFAN,
     6ALPMAX,THSHL,XFCABL,XNDMIN,DVMX,DAVMX,DEAVMX,DEMX,TDC,QDCU,QDCUO2,
     7TSINJ,EINJ,DTINJ,TKINJ,ROEV,CPINJ,SURFT,VSINJ,EMINJ,TSINJO,EINJO,
     8DTINJO,TKINJO,ROEVO,CPINJO,SURFTO,VSINJO,EMINJO,XLEADE,ARSUM,
     9DBUBOX,UTRISE,TREMSH,DJET,DFALL,WEBER,FROUDE,XPSAITO,XPEPSTN,
     1FRAG,XMBEDT,XMBED(16),XLPENT,XLPENA,UJET,UFALL,HFALL,ERPV,
     2TJETT(99),DJETT(99),HWATP,XDOTJET,DVMXW,DAVMXW,DEMXW,DEAVMXW,
     3QJETW,XSTMJF,TINTSJF,ESAT,DRDOOR,DRANL,EI,QDCBUO2,QDCBU,
     4EBEDS,EBEDB
      COMMON/PROPM/DTDEM(999),CPMLT(999),FKMLT(999),DENMLT(999),
     1SIGMLT(999),UMMLT(999),EMIMLT(999)      
C.....FIRST FIND NODE WHICH IS A RECEPTOR FOR CORIUM SUCH THAT THE 
C.....THERMOPHYSICAL PROPERTIES OF THE IMPINGING MELT MAY BE 
C.....ASSIGNED AS RELEVANT.
      JSEND=1
      IF(NGEOM.EQ.1) GO TO 4533
      DO 4534 I=1,NUMNOD
      IF(IFLGA(I).EQ.1) JSEND=I
 4534 CONTINUE
 4533 CONTINUE
      IF(SRCTOT(JSEND).LE.0.D0) GO TO 4535
C.....FIRST GET MINIMUM SPREADING DEPTH AS WELL AS SPARGING GAS
C.....BUBBLE DIAMETER AND RISE VELOCITY WHICH ARE APPROXIMATED BASED
C.....ON MELT POUR PROPERTIES 
      HMN=SQRT(SURFT/(GRAV*ROEV))
      HMINC=HMN*SQRT(2.D0)      
      DBUBOX=PI*HMN*SQRT(3.D0)  
      UTRISE=1.18D0*((GRAV*SURFT)/ROEV)**0.25D0     
C.....GO LIKELY LOCATION OF MELT LEADING EDGE.. 
      IHTE=1
      DO 77 K=1,NUMNOD
      IF(HTOT(K).LE.HMINC) GO TO 77      
      IHTE=K
   77 CONTINUE
 4535 CONTINUE
C.....NOW CHECK TO ACTIVATE NODES
      DO 7725 KN=1,NUMNOD
      IF(NACTIV(KN).EQ.1) GO TO 4537      
      NPNG=1
      IF(HTOT(KN).LE.HMINC) NPNG=0
      IF(NPNG.EQ.0.AND.KN.GE.IHTE) GO TO 7725
      NACTIV(KN)=1    
      XLEADE=RAD(KN)+0.5*DXNODE(KN)
      ARSUM=ARSUM+AREA(KN)
      GO TO 3891      
 4537 CONTINUE
      IF(HTOT(KN).LE.HMINC) GO TO 7725   
      IF(HTOLD(KN).LE.0.D0) GO TO 3891    
      GO TO 7725      
C.....SET INITIAL MELT ENTHALPY ACCORDING TO ARRIVING TEMPERATURE OF    
C.....INJECTED MATERIAL (FROM RPV).  IF MELT IS CONVECTED INTO THE      
C.....NODE, SET INITIAL TEMPERATURE ACCORDING TO CONVECTED MATERIAL.    
 3891 CONTINUE
      IF(SRCTOT(KN).LE.0.D0) GO TO 7726   
      TBULK(KN)=TSINJ 
      ENBLK(KN)=EINJ  
      EBKOLD(KN)=EINJ 
      DTDEM(KN)=DTINJ 
      FKMLT(KN)=TKINJ 
      DENMLT(KN)=ROEV 
      CPMLT(KN)=CPINJ 
      SIGMLT(KN)=SURFT
      UMMLT(KN)=VSINJ 
      VISREX(KN)=VSINJ
      EMIMLT(KN)=EMINJ
      GO TO 7725      
 7726 CONTINUE 
      NLOC=KN-1
      IF(KN.EQ.1) NLOC=KN+1
      IF(KN.LT.JSEND) NLOC=KN+1
      TBULK(KN)=TBULK(NLOC)
      ENBLK(KN)=ENBLK(NLOC)
      EBKOLD(KN)=ENBLK(KN)      
      DTDEM(KN)=DTDEM(NLOC)     
      FKMLT(KN)=FKMLT(NLOC)     
      DENMLT(KN)=DENMLT(NLOC)   
      CPMLT(KN)=CPMLT(NLOC)     
      SIGMLT(KN)=SIGMLT(NLOC)   
      UMMLT(KN)=UMMLT(NLOC)     
      VISREX(KN)=UMMLT(NLOC)
      EMIMLT(KN)=EMIMLT(NLOC)   
 7725 CONTINUE
      RETURN
      END